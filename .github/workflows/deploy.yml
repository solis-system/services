name: "Docker Deploy"

on:
  workflow_call:
    inputs:
      image_name:
        description: "Nom complet de lâ€™image Docker (ex: registry.solisws.fr/app)"
        required: true
        type: string
      mattermost_webhook:
        description: "Webhook Mattermost (optionnel)"
        required: false
        type: string

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Run deploy script
        shell: bash
        run: bash ./entrypoint.sh
        env:
          DOCKER_REGISTRY: ${{ secrets.DOCKER_REGISTRY }}
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          IMAGE_NAME: ${{ inputs.image_name }}
          MATTERMOST_WEBHOOK: ${{ inputs.mattermost_webhook }}
          GITHUB_REF_NAME: ${{ github.ref_name }}